app-id: com.github.Red.DiscordBot
branch: stable

runtime: org.freedesktop.Sdk
runtime-version: 18.08
sdk: org.freedesktop.Sdk
sdk-extensions: [org.freedesktop.Sdk.Extension.openjdk11]

command: redbot-launcher
    
finish-args:
  - --socket=pulseaudio
  - --share=network
  - --allow=multiarch

modules:

  - name: redbot
    buildsystem: simple
    build-commands:
      - install -d /app/bin
      - /usr/lib/sdk/openjdk11/install.sh
      - install redbot-install /app/bin
      - install redbot-launcher /app/bin
    sources:
      - type: script
        dest-filename: redbot-install
        commands:
          - pip3 install --user -U --process-dependency-links --no-cache-dir Red-DiscordBot[voice,mongo] python-Levenshtein
          - echo "Installer finished"
      - type: script
        dest-filename: redbot-launcher
        commands:
          - export PYTHONUSERBASE=$XDG_DATA_HOME
          - export PATH=$PATH:/app/jre/bin
          - '[ -f $XDG_DATA_HOME/bin/redbot-launcher ] || . /app/bin/redbot-install'
          - echo "Launching launcher"
          - cd ".var/app/com.github.Red.DiscordBot/data/bin/"
          - chmod +x redbot-launcher
          - python3 redbot-launcher
